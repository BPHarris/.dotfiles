autogenerated = 0
monitor=,preferred,auto,1


source = ~/.config/theme/colours/hyprland.conf


# ENVIRONMENT VARS
# ================
env = XDG_CURRENT_DESKTOP,Hyprland

env = XCURSOR_SIZE,24
env = QT_QPA_PLATFORMTHEME,qt5ct

env = GTK_THEME,bpharris
env = ICON_THEME,bpharris


# START UP
# ========
exec-once = dbus-update-activation-environment --systemd --all
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE

# Trigger user hyprland systemd service
# Which in turn have a dependency tree of auto start programs
# E.g. gnome-keyring -> nextcloud
#      mullvad-vpn   ^
exec-once = systemctl --user start hyprland-session.target

exec-once = /usr/lib/xdg-desktop-portal-hyprland

exec-once = /usr/lib/polkit-kde-authentication-agent-1

# Handled by shell
# exec-once = mako
# exec-once = dunst

exec-once = quickshell
# exec-once = QS_ICON_THEME=bpharris caelestia shell -d

# Handled by shell
# exec-once = blueman-applet

exec-once = wl-clipboard

exec-once = hypridle


# WINDOW MANAGER CONFIG
# =====================
general {
	gaps_in = 4
	gaps_out = 8

	border_size = 1
	no_border_on_floating = false

	col.active_border = rgb($col_bright_white)
	col.inactive_border = rgb($col_black)

	layout = master

	resize_on_border = true
	extend_border_grab_area = 25
	hover_icon_on_border = true

	allow_tearing = false

	snap {
		enabled = true
		window_gap = 10
		monitor_gap = 10
		border_overlap = true
	}
}

decoration {
	rounding = 4

	active_opacity = 1.0
	inactive_opacity = 1.0
	fullscreen_opacity = 1.0

	blur {
		enabled = false
		size = 3
		passes = 1
	}

	shadow {
		enabled = true
		range = 16
		render_power = 2
		color = rgb(161616)
	}

	dim_inactive = true
	dim_strength = 0.1
	dim_special = 0.1
}

animations {
	enabled = true

	first_launch_animation = false  # TEST THIS

	bezier = overshot, 0.05, 0.9, 0.1, 1.02

	animation = windows, 1, 7, overshot
	animation = windowsOut, 1, 7, default, popin 80%
	animation = border, 1, 10, default
	animation = borderangle, 1, 8, default
	animation = fade, 1, 7, default
	animation = workspaces, 1, 6, default

	animation = layersIn, 1, 2, default, popin 90%
	animation = layersOut, 1, 3, default
}
layerrule = noanim, ^(logout_dialog)$  # I've forgotten what this does
layerrule = noanim, ^(selection)$  # I've forgotten what this does

input {
	kb_layout = gb
	kb_options = caps:swapescape

	follow_mouse = 1

	sensitivity = 0.3
	accel_profile = flat

	touchpad {
		disable_while_typing = true
		natural_scroll = true
	}
}

device {
	name = dll0945:00-06cb:cde6-touchpad

	accel_profile = adaptive
	sensitivity = 0.2
}

gestures {
	workspace_swipe = true
	workspace_swipe_fingers = 3
	workspace_swipe_forever = true
}

group {

}

misc {
	# Disable the anime girl default background.
	# When left enabled this flashes quickly while quickshell is loading, which is
	# annoying, disabling results in a dark grey screen instead which transitions nicer.
	disable_hyprland_logo = true
	disable_splash_rendering = true
	force_default_wallpaper = 0

	# Global font setting
	# Includes hyprland error notification
	font_family = "FiraCode Nerd Font Mono:style=Regular:size=14"

	# Window swallowing
	# This might not be working :(
	enable_swallow = true
	swallow_regex = ^(Alacritty|alacritty)$

	# When in fullscreen a new tiled window will cause us to exit fullscreen
	new_window_takes_over_fullscreen = 2

	# Windows (and all children) will open on the workspace they are invoked on
	initial_workspace_tracking = 2

	middle_click_paste = false
}

binds {
	allow_workspace_cycles = true
	workspace_back_and_forth = false
}

# Layout configuration
dwindle {
	pseudotile = yes
	preserve_split = yes
}
master {
	new_status = master
	smart_resizing = false
}


# TWEAKS / FIXES
# ==============
# Smart gaps for non-special workspaces
# I.e. disable gaps when this is the only window and in fullscreen
# For special workspaces we use gaps to centre the window
workspace = w[tv1]s[false], gapsout:0, gapsin:0
workspace = f[1]s[false], gapsout:0, gapsin:0
windowrule = bordersize 0, floating:0, onworkspace:w[tv1]s[false]
windowrule = rounding 0, floating:0, onworkspace:w[tv1]s[false]
windowrule = bordersize 0, floating:0, onworkspace:f[1]s[false]
windowrule = rounding 0, floating:0, onworkspace:f[1]s[false]


# Fix steam
env = STEAM_USE_DYNAMIC_VRS,1


# KEY BINDS
# =========
$mod = super

# Application exec helpers
$terminal = alacritty
$tmux = alacritty --command tmux
$emoji_picker = rofimoji -a print type copy


# Spawns
bind = $mod, return, exec, $terminal
bind = $mod, p, exec, pkill wofi || wofi --show drun
bind = $mod, e, exec, $emoji_picker


# WM Controls
bind = $mod shift, Q, killactive,
bind = $mod shift alt, Q, exit,

bind = $mod shift, l, exec, loginctl lock-session
# bind = ctrl alt, delete, exec, wlogout -b 4  # Need to setup in shell
bind = $mod alt, h, exec, systemctl hibernate

bind = $mod, v, togglefloating,
bind = $mod shift, f, fullscreen

binde = $mod, j, layoutmsg, cyclenext  # might break on dwindle
binde = $mod, k, layoutmsg, cycleprev  # might break on dwindle
bind  = $mod, h, splitratio, -0.05
bind  = $mod, l, splitratio, +0.05

binde = $mod, left,  movefocus, l
binde = $mod, up,    movefocus, u
binde = $mod, down,  movefocus, d
binde = $mod, right, movefocus, r

# WM Controls: master layout
bind = $mod, space, layoutmsg, swapwithmaster child, focuswindow, master

bind = $mod alt, j, layoutmsg, rollprev
bind = $mod alt, k, layoutmsg, rollnext

binde = $mod alt, space, layoutmsg, orientationcycle
bind  = $mod alt, c,     layoutmsg, orientationcenter
bind  = $mod alt, l,     layoutmsg, orientationleft
bind  = $mod alt, r,     layoutmsg, orientationright
bind  = $mod alt, t,     layoutmsg, orientationtop
bind  = $mod alt, b,     layoutmsg, orientationbottom

# WM Controls: workspaces
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

bind = $mod shift, 1, movetoworkspace, 1
bind = $mod shift, 2, movetoworkspace, 2
bind = $mod shift, 3, movetoworkspace, 3
bind = $mod shift, 4, movetoworkspace, 4
bind = $mod shift, 5, movetoworkspace, 5
bind = $mod shift, 6, movetoworkspace, 6
bind = $mod shift, 7, movetoworkspace, 7
bind = $mod shift, 8, movetoworkspace, 8
bind = $mod shift, 9, movetoworkspace, 9
bind = $mod shift, 0, movetoworkspace, 10

bind = $mod, tab, workspace, previous


# Screenshots
# TODO Try out grimblast
$screenshot_path = $(xdg-user-dir PICTURES)/screenshots/$(date -u "+%Y-%m-%d_%H-%M-%S.png")
bind = , print, exec, grim - | tee $screenshot_path | wl-copy
bind = shift, print, exec, grim -g "$(slurp)" - | tee $screenshot_path | wl-copy
# TODO swappy dumps image in ~ and I don't like that it doesn't save&exit on return
# bind = $mod, print, exec, grim -g "$(slurp)" - | swappy -f - | tee $screenshot_path | wl-copy


# Scratch pads
workspace = special:scratchpad_terminal, on-created-empty:[stayfocused]$terminal, gapsout:150
bind = $mod shift, s, togglespecialworkspace, scratchpad_terminal

workspace = special:scratchpad_htop, on-created-empty:$terminal --command htop, gapsout:150
bind = $mod shift, h, togglespecialworkspace, scratchpad_htop

workspace = special:scratchpad_btop, on-created-empty:$terminal --command btop, gapsout:150
bind = $mod shift, b, togglespecialworkspace, scratchpad_btop

workspace = special:scratchpad_keepassxc, on-created-empty:keepassxc, gapsout:150
bind = $mod shift, k, togglespecialworkspace, scratchpad_keepassxc
windowrulev2 = workspace special:scratchpad_keepassxc, class:^(?i)keepassxc$
windowrulev2 = focusonactivate, class:^(?i)keepassxc$


# Media controls
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioPause, exec, playerctl play-pause
bind = , XF86AudioPrev, exec, playerctl previous
bind = , XF86AudioNext, exec, playerctl next

binde = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
binde = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bind = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

bind = , XF86MonBrightnessUp, exec, brightnessctl set +5%
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%-


# Mouse controls
bind = $mod, mouse_up, workspace, e+1
bind = $mod, mouse_down, workspace, e-1

bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

