#!/bin/sh

program=$(basename "$0")

pape="$(xdg-user-dir PICTURES).wallpaper"
monitors=$(hyprctl monitors | grep Monitor | awk '{print $2}')


usage() {
	echo "usage: $program [-h] [file]"
	echo ""
	echo "set the current wallpaper (from \$(xdg-user-dir PICTURES)/.wallpaper)"
	echo "if a file is given then the current wallpaper is updated"
	echo ""
	echo "-h: prints help"
	exit 0
}


die() {
	echo "$program: $*"
	exit 1
}


update_user_wallpaper() {
	if [ ! -f "$1" ]; then
		die "$1 does not exist"
	fi

	cp "$1" "$pape"
	chmod 644 "$pape"
}


set_wallpaper() {
	hyprctl hyprpaper unload all
	hyprctl hyprpaper preload "$pape"

	for monitor in $monitors ; do
		hyprctl hyprpaper wallpaper "$monitor,$pape"
	done
}



if [ $# -eq 0 ]; then
	set_wallpaper
elif [ $# -eq 1 ]; then
	if [ "$1" = "-h" ] || [ "$1" = "--help" ] ; then
		usage
	fi
	update_user_wallpaper "$1"
	set_wallpaper
else
	die "too many args"
fi


exit 0

