#!/bin/sh


STEP=2

DURATION=800

USE_MUTE_ICON_ON_VOLUME_0=true
VOLUME_LOW_CUTOFF=33
VOLUME_MEDIUM_CUTOFF=67

NAME=$(basename "$0")

MISC_ID=86000
MUTE_ID=86001
MUTE_MIC_ID=86003
VOLUME_ID=86002


if ! command -v pamixer >/dev/null ; then
	notify-send -r "$MISC_ID" -i "script-error" "Error" "Missing prerequisite pamixer"
	exit 1
fi


usage() {
	echo "$NAME -- xf86 controls for pulseaudio"
	echo ""
	echo "usage:"
	echo "    $NAME [-h | --help]"
	echo "    $NAME command"
	echo ""
	echo "commands:"
	echo "    toggle-mute     -- toggle mute and notify"
	echo "    toggle-mute-mic -- toggle mute microphone and notify"
	echo "    volume-up       -- increase volume by $STEP and notify"
	echo "    volume-down     -- decrease volume by $STEP and notify"
	exit 0
}


icon() {
	level=$(pamixer --get-volume)

	if [ "$level" -eq 0 ] && [ "$USE_MUTE_ICON_ON_VOLUME_0" = "true" ] ; then
		echo "notification-audio-volume-off"
	elif [ "$level" -le "$VOLUME_LOW_CUTOFF" ] ; then
		echo "notification-audio-volume-low"
	elif [ "$level" -le "$VOLUME_MEDIUM_CUTOFF" ] ; then
		echo "notification-audio-volume-medium"
	else
		echo "notification-audio-volume-high"
	fi
}


mute() {
	pamixer --toggle-mute

	if [ "$(pamixer --get-mute)" = "true" ] ; then
		notify-send -r "$MUTE_ID" -t "$DURATION" -i "notification-audio-volume-muted" "Volume" "Muted"
	else
		notify-send -r "$MUTE_ID" -t "$DURATION" -i "$(icon)" "Volume" "Unmuted"
	fi
}

mute_mic() {
	source_id=$(pamixer --list-sources | grep "input" | head -n 1 | awk '{print $1}')

	pamixer --source "$source_id" -t

	if [ "$(pamixer --source "$source_id" --get-mute)" = "true" ] ; then
		notify-send -r "$MUTE_MIC_ID" -t "$DURATION" -i "microphone-sensitivity-muted-symbolic" "Microphone" "Muted"
	else
		notify-send -r "$MUTE_MIC_ID" -t "$DURATION" -i "microphone-sensitivity-high-symbolic" "Microphone" "Unmuted"
	fi
}


up() {
	pamixer --increase "$STEP"
	notify-send -r "$VOLUME_ID" -t "$DURATION" -i "$(icon)" -h "int:value:$(pamixer --get-volume)" "Volume" "Increased"
}


down() {
	pamixer --decrease "$STEP"
	notify-send -r "$VOLUME_ID" -t "$DURATION" -i "$(icon)" -h "int:value:$(pamixer --get-volume)" "Volume" "Decreased"
}


if [ "$1" = "toggle-mute" ] ; then
	mute
elif [ "$1" = "toggle-mute-mic" ] ; then
	mute_mic
elif [ "$1" = "volume-up" ] ; then
	up
elif [ "$1" = "volume-down" ] ; then
	down
else
	usage
fi

exit 0

